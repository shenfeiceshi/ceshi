<!--å‘¨æŠ¥é¡µé¢-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="report-title">æˆé•¿å‘¨æŠ¥</view>
      <view class="report-subtitle">è®°å½•ä½ è¿™ä¸€å‘¨çš„ç²¾å½©æ—¶å…‰</view>
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="shareReport">
        <text class="action-icon">ğŸ“¤</text>
      </view>
      <view class="action-btn" bindtap="exportReport">
        <text class="action-icon">ğŸ“¥</text>
      </view>
    </view>
  </view>

  <!-- å‘¨æœŸé€‰æ‹© -->
  <view class="week-selector">
    <view class="selector-btn" bindtap="prevWeek">
      <text class="selector-icon">â—€</text>
    </view>
    <view class="week-info">
      <view class="week-range">{{weekRange}}</view>
      <view class="week-desc">ç¬¬{{weekNumber}}å‘¨</view>
    </view>
    <view class="selector-btn" bindtap="nextWeek">
      <text class="selector-icon">â–¶</text>
    </view>
  </view>

  <!-- æœ¬å‘¨æ¦‚è§ˆ -->
  <view class="week-overview">
    <view class="overview-title">
      <text class="title-icon">ğŸ“Š</text>
      <text>æœ¬å‘¨æ¦‚è§ˆ</text>
    </view>
    <view class="overview-grid">
      <view class="overview-item">
        <view class="item-icon">ğŸ“</view>
        <view class="item-number">{{weekData.diaryCount}}</view>
        <view class="item-label">å†™äº†æ—¥è®°</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">âœ…</view>
        <view class="item-number">{{weekData.taskCount}}</view>
        <view class="item-label">å®Œæˆä»»åŠ¡</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">ğŸ¯</view>
        <view class="item-number">{{weekData.pointsEarned}}</view>
        <view class="item-label">è·å¾—ç§¯åˆ†</view>
      </view>
      <view class="overview-item">
        <view class="item-icon">ğŸ†</view>
        <view class="item-number">{{weekData.streakDays}}</view>
        <view class="item-label">è¿ç»­å¤©æ•°</view>
      </view>
    </view>
  </view>

  <!-- ä»»åŠ¡å®Œæˆæƒ…å†µ -->
  <view class="task-progress">
    <view class="progress-title">
      <text class="title-icon">ğŸ“‹</text>
      <text>ä»»åŠ¡å®Œæˆæƒ…å†µ</text>
    </view>
    <view class="progress-content">
      <view class="progress-stats">
        <view class="stat-item">
          <view class="stat-label">å·²å®Œæˆ</view>
          <view class="stat-value">{{weekData.completedTasks}}/{{weekData.totalTasks}}</view>
        </view>
        <view class="stat-item">
          <view class="stat-label">å®Œæˆç‡</view>
          <view class="stat-value">{{weekData.completionRate}}%</view>
        </view>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{weekData.completionRate}}%"></view>
      </view>
    </view>
    <view class="task-categories">
      <view class="category-item" wx:for="{{weekData.taskCategories}}" wx:key="category">
        <view class="category-name">{{item.name}}</view>
        <view class="category-progress">
          <view class="category-bar">
            <view class="category-fill" style="width: {{item.progress}}%; background-color: {{item.color}}"></view>
          </view>
          <view class="category-text">{{item.completed}}/{{item.total}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç§¯åˆ†å˜åŒ–è¶‹åŠ¿ -->
  <view class="points-trend">
    <view class="trend-title">
      <text class="title-icon">ğŸ“ˆ</text>
      <text>ç§¯åˆ†å˜åŒ–è¶‹åŠ¿</text>
    </view>
    <view class="trend-chart">
      <canvas class="trend-canvas" canvas-id="pointsChart" disable-scroll="true"></canvas>
    </view>
    <view class="trend-summary">
      <view class="summary-item">
        <view class="summary-label">æœ¬å‘¨è·å¾—</view>
        <view class="summary-value positive">+{{weekData.pointsEarned}}</view>
      </view>
      <view class="summary-item">
        <view class="summary-label">æœ¬å‘¨æ¶ˆè´¹</view>
        <view class="summary-value negative">-{{weekData.pointsSpent}}</view>
      </view>
      <view class="summary-item">
        <view class="summary-label">å‡€å¢é•¿</view>
        <view class="summary-value {{weekData.pointsNet >= 0 ? 'positive' : 'negative'}}">
          {{weekData.pointsNet >= 0 ? '+' : ''}}{{weekData.pointsNet}}
        </view>
      </view>
    </view>
  </view>

  <!-- æœ¬å‘¨äº®ç‚¹ -->
  <view class="week-highlights">
    <view class="highlights-title">
      <text class="title-icon">â­</text>
      <text>æœ¬å‘¨äº®ç‚¹</text>
    </view>
    <view class="highlights-list">
      <view class="highlight-item" wx:for="{{weekData.highlights}}" wx:key="id">
        <view class="highlight-icon">{{item.icon}}</view>
        <view class="highlight-content">
          <view class="highlight-title">{{item.title}}</view>
          <view class="highlight-desc">{{item.description}}</view>
          <view class="highlight-date">{{item.date}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ¬å‘¨æ—¥è®°ç²¾é€‰ -->
  <view class="week-diaries">
    <view class="diaries-title">
      <text class="title-icon">ğŸ“–</text>
      <text>æœ¬å‘¨æ—¥è®°ç²¾é€‰</text>
    </view>
    <view class="diaries-list">
      <view class="diary-item" wx:for="{{weekData.diaries}}" wx:key="id" bindtap="viewDiary" data-id="{{item.id}}">
        <view class="diary-date">{{item.dateDisplay}}</view>
        <view class="diary-mood">
          <text class="mood-icon">{{item.moodIcon}}</text>
          <text class="mood-name">{{item.moodName}}</text>
        </view>
        <view class="diary-preview">{{item.preview}}</view>
        <view class="diary-meta">
          <text class="meta-item">{{item.wordCount}}å­—</text>
          <text class="meta-item" wx:if="{{item.images.length > 0}}">{{item.images.length}}å›¾</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆé•¿å»ºè®® -->
  <view class="growth-suggestions">
    <view class="suggestions-title">
      <text class="title-icon">ğŸ’¡</text>
      <text>æˆé•¿å»ºè®®</text>
    </view>
    <view class="suggestions-list">
      <view class="suggestion-item" wx:for="{{weekData.suggestions}}" wx:key="*this">
        <view class="suggestion-icon">ğŸ’¡</view>
        <view class="suggestion-text">{{item}}</view>
      </view>
    </view>
  </view>

  <!-- ä¸‹å‘¨ç›®æ ‡ -->
  <view class="next-week-goals">
    <view class="goals-title">
      <text class="title-icon">ğŸ¯</text>
      <text>ä¸‹å‘¨ç›®æ ‡</text>
    </view>
    <view class="goals-list">
      <view class="goal-item" wx:for="{{weekData.nextWeekGoals}}" wx:key="id">
        <view class="goal-checkbox" bindtap="toggleGoal" data-id="{{item.id}}">
          <text class="checkbox-icon">{{item.completed ? 'âœ…' : 'â­•'}}</text>
        </view>
        <view class="goal-text">{{item.text}}</view>
        <view class="goal-reward">{{item.points}}åˆ†</view>
      </view>
    </view>
    <view class="add-goal-btn" bindtap="addGoal">
      <text class="add-icon">â•</text>
      <text>æ·»åŠ ç›®æ ‡</text>
    </view>
  </view>

  <!-- åˆ†äº«å’Œå¯¼å‡º -->
  <view class="report-actions">
    <view class="action-item" bindtap="shareReport">
      <text class="action-icon">ğŸ“¤</text>
      <text class="action-text">åˆ†äº«å‘¨æŠ¥</text>
    </view>
    <view class="action-item" bindtap="exportReport">
      <text class="action-icon">ğŸ“¥</text>
      <text class="action-text">å¯¼å‡ºæŠ¥å‘Š</text>
    </view>
    <view class="action-item" bindtap="viewMonthlyReport">
      <text class="action-icon">ğŸ“…</text>
      <text class="action-text">æŸ¥çœ‹æœˆæŠ¥</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <view class="loading-text">æ­£åœ¨ç”Ÿæˆå‘¨æŠ¥...</view>
    </view>
  </view>

  <!-- åˆ†äº«å¼¹çª— -->
  <view class="share-modal" wx:if="{{showShareModal}}" bindtap="hideShareModal">
    <view class="share-content" catchtap="stopPropagation">
      <view class="share-title">åˆ†äº«å‘¨æŠ¥</view>
      <view class="share-options">
        <view class="share-option" bindtap="shareToFriend">
          <text class="share-icon">ğŸ‘¥</text>
          <text class="share-text">åˆ†äº«ç»™æœ‹å‹</text>
        </view>
        <view class="share-option" bindtap="shareToMoments">
          <text class="share-icon">ğŸŒŸ</text>
          <text class="share-text">åˆ†äº«åˆ°æœ‹å‹åœˆ</text>
        </view>
        <view class="share-option" bindtap="saveToAlbum">
          <text class="share-icon">ğŸ’¾</text>
          <text class="share-text">ä¿å­˜åˆ°ç›¸å†Œ</text>
        </view>
      </view>
      <view class="share-cancel" bindtap="hideShareModal">å–æ¶ˆ</view>
    </view>
  </view>
</view>
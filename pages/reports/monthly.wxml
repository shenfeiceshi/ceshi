<!--æœˆæŠ¥é¡µé¢-->
<view class="container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="report-title">æˆé•¿æœˆæŠ¥</view>
      <view class="report-subtitle">å›é¡¾è¿™ä¸ªæœˆçš„æˆé•¿è¶³è¿¹</view>
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="shareReport">
        <text class="action-icon">ğŸ“¤</text>
      </view>
      <view class="action-btn" bindtap="exportReport">
        <text class="action-icon">ğŸ“¥</text>
      </view>
    </view>
  </view>

  <!-- æœˆä»½é€‰æ‹© -->
  <view class="month-selector">
    <view class="selector-btn" bindtap="prevMonth">
      <text class="selector-icon">â—€</text>
    </view>
    <view class="month-info">
      <view class="month-name">{{monthName}}</view>
      <view class="month-desc">{{year}}å¹´</view>
    </view>
    <view class="selector-btn" bindtap="nextMonth">
      <text class="selector-icon">â–¶</text>
    </view>
  </view>

  <!-- æœˆåº¦æˆå°± -->
  <view class="month-achievements">
    <view class="achievements-title">
      <text class="title-icon">ğŸ†</text>
      <text>æœˆåº¦æˆå°±</text>
    </view>
    <view class="achievements-grid">
      <view class="achievement-item">
        <view class="achievement-icon">ğŸ“</view>
        <view class="achievement-number">{{monthData.totalDiaries}}</view>
        <view class="achievement-label">ç¯‡æ—¥è®°</view>
        <view class="achievement-change positive" wx:if="{{monthData.diaryChange > 0}}">
          +{{monthData.diaryChange}}
        </view>
      </view>
      <view class="achievement-item">
        <view class="achievement-icon">âœ…</view>
        <view class="achievement-number">{{monthData.totalTasks}}</view>
        <view class="achievement-label">ä¸ªä»»åŠ¡</view>
        <view class="achievement-change positive" wx:if="{{monthData.taskChange > 0}}">
          +{{monthData.taskChange}}
        </view>
      </view>
      <view class="achievement-item">
        <view class="achievement-icon">ğŸ¯</view>
        <view class="achievement-number">{{monthData.totalPoints}}</view>
        <view class="achievement-label">ç§¯åˆ†</view>
        <view class="achievement-change positive" wx:if="{{monthData.pointsChange > 0}}">
          +{{monthData.pointsChange}}
        </view>
      </view>
      <view class="achievement-item">
        <view class="achievement-icon">ğŸ”¥</view>
        <view class="achievement-number">{{monthData.maxStreak}}</view>
        <view class="achievement-label">æœ€é•¿è¿ç»­</view>
      </view>
    </view>
  </view>

  <!-- æ´»è·ƒåº¦æ—¥å† -->
  <view class="calendar-heatmap">
    <view class="heatmap-title">
      <text class="title-icon">ğŸ“…</text>
      <text>æ´»è·ƒåº¦æ—¥å†</text>
    </view>
    <view class="calendar-grid">
      <view class="calendar-header">
        <view class="weekday" wx:for="{{weekdays}}" wx:key="*this">{{item}}</view>
      </view>
      <view class="calendar-weeks">
        <view class="calendar-week" wx:for="{{calendarWeeks}}" wx:key="week">
          <view class="calendar-day {{day.isCurrentMonth ? '' : 'other-month'}} {{day.hasActivity ? 'active' : ''}}" 
                wx:for="{{item.days}}" 
                wx:for-item="day" 
                wx:key="date"
                style="background-color: {{day.activityColor}}"
                bindtap="viewDayDetail"
                data-date="{{day.date}}">
            <text class="day-number">{{day.day}}</text>
          </view>
        </view>
      </view>
    </view>
    <view class="activity-legend">
      <text class="legend-label">æ´»è·ƒåº¦ï¼š</text>
      <view class="legend-items">
        <view class="legend-item" wx:for="{{activityLevels}}" wx:key="level">
          <view class="legend-color" style="background-color: {{item.color}}"></view>
          <text class="legend-text">{{item.label}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿ƒæƒ…åˆ†æ -->
  <view class="mood-analysis">
    <view class="analysis-title">
      <text class="title-icon">ğŸ˜Š</text>
      <text>å¿ƒæƒ…åˆ†æ</text>
    </view>
    <view class="mood-chart-container">
      <canvas class="mood-chart" canvas-id="monthlyMoodChart" disable-scroll="true"></canvas>
    </view>
    <view class="mood-stats">
      <view class="mood-stat" wx:for="{{monthData.moodStats}}" wx:key="mood">
        <view class="mood-icon">{{item.icon}}</view>
        <view class="mood-info">
          <view class="mood-name">{{item.name}}</view>
          <view class="mood-count">{{item.count}}å¤©</view>
        </view>
        <view class="mood-percentage">{{item.percentage}}%</view>
      </view>
    </view>
  </view>

  <!-- æˆé•¿æ—¶é—´çº¿ -->
  <view class="growth-timeline">
    <view class="timeline-title">
      <text class="title-icon">ğŸ“ˆ</text>
      <text>æˆé•¿æ—¶é—´çº¿</text>
    </view>
    <view class="timeline-list">
      <view class="timeline-item" wx:for="{{monthData.timeline}}" wx:key="id">
        <view class="timeline-date">{{item.date}}</view>
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <view class="timeline-title">{{item.title}}</view>
          <view class="timeline-desc">{{item.description}}</view>
          <view class="timeline-tags">
            <view class="timeline-tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">
              {{tag}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœˆåº¦æ€»ç»“ -->
  <view class="month-summary">
    <view class="summary-title">
      <text class="title-icon">ğŸ“‹</text>
      <text>æœˆåº¦æ€»ç»“</text>
    </view>
    <view class="summary-content">
      <view class="summary-section">
        <view class="section-title">ğŸ¯ ä¸»è¦æˆå°±</view>
        <view class="section-content">{{monthData.achievements}}</view>
      </view>
      <view class="summary-section">
        <view class="section-title">ğŸ“š å­¦ä¹ æ”¶è·</view>
        <view class="section-content">{{monthData.learnings}}</view>
      </view>
      <view class="summary-section">
        <view class="section-title">ğŸ¤” åæ€æ”¹è¿›</view>
        <view class="section-content">{{monthData.reflections}}</view>
      </view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œ -->
  <view class="monthly-ranking">
    <view class="ranking-title">
      <text class="title-icon">ğŸ†</text>
      <text>æœ¬æœˆæ’è¡Œ</text>
    </view>
    <view class="ranking-tabs">
      <view class="tab-item {{activeTab === 'diary' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="diary">æ—¥è®°æ¦œ</view>
      <view class="tab-item {{activeTab === 'task' ? 'active' : ''}}" 
            bindtap="switchTab" 
            data-tab="task">ä»»åŠ¡æ¦œ</view>
    </view>
    <view class="ranking-list">
      <view class="ranking-item" wx:for="{{currentRanking}}" wx:key="id">
        <view class="rank-number">{{item.rank}}</view>
        <view class="rank-avatar">
          <text class="avatar-text">{{item.name.charAt(0)}}</text>
        </view>
        <view class="rank-info">
          <view class="rank-name">{{item.name}}</view>
          <view class="rank-score">{{item.score}}</view>
        </view>
        <view class="rank-badge" wx:if="{{item.rank <= 3}}">
          <text class="badge-icon">{{item.rank === 1 ? 'ğŸ¥‡' : item.rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸‹æœˆè®¡åˆ’ -->
  <view class="next-month-plan">
    <view class="plan-title">
      <text class="title-icon">ğŸ“‹</text>
      <text>ä¸‹æœˆè®¡åˆ’</text>
    </view>
    <view class="plan-categories">
      <view class="plan-category" wx:for="{{monthData.nextMonthPlan}}" wx:key="category">
        <view class="category-header">
          <view class="category-icon">{{item.icon}}</view>
          <view class="category-name">{{item.name}}</view>
        </view>
        <view class="category-goals">
          <view class="goal-item" wx:for="{{item.goals}}" wx:for-item="goal" wx:key="id">
            <view class="goal-checkbox" bindtap="togglePlanGoal" data-category="{{item.category}}" data-id="{{goal.id}}">
              <text class="checkbox-icon">{{goal.completed ? 'âœ…' : 'â­•'}}</text>
            </view>
            <view class="goal-text">{{goal.text}}</view>
            <view class="goal-reward">{{goal.points}}åˆ†</view>
          </view>
        </view>
      </view>
    </view>
    <view class="add-plan-btn" bindtap="addPlan">
      <text class="add-icon">â•</text>
      <text>æ·»åŠ è®¡åˆ’</text>
    </view>
  </view>

  <!-- å¹´åº¦ç›®æ ‡è¿›åº¦ -->
  <view class="yearly-progress">
    <view class="progress-title">
      <text class="title-icon">ğŸ¯</text>
      <text>å¹´åº¦ç›®æ ‡è¿›åº¦</text>
    </view>
    <view class="yearly-goals">
      <view class="yearly-goal" wx:for="{{monthData.yearlyGoals}}" wx:key="id">
        <view class="goal-info">
          <view class="goal-name">{{item.name}}</view>
          <view class="goal-progress-text">{{item.current}}/{{item.target}}</view>
        </view>
        <view class="goal-progress-bar">
          <view class="progress-fill" style="width: {{item.percentage}}%"></view>
        </view>
        <view class="goal-percentage">{{item.percentage}}%</view>
      </view>
    </view>
    <view class="view-yearly-btn" bindtap="viewYearlyReport">
      <text class="action-icon">ğŸ“…</text>
      <text>æŸ¥çœ‹å¹´æŠ¥</text>
    </view>
  </view>

  <!-- åˆ†äº«é€‰é¡¹ -->
  <view class="share-section">
    <view class="share-title">åˆ†äº«æœˆæŠ¥</view>
    <view class="share-options">
      <view class="share-option" bindtap="shareToFriend">
        <text class="share-icon">ğŸ‘¥</text>
        <text class="share-text">åˆ†äº«ç»™æœ‹å‹</text>
      </view>
      <view class="share-option" bindtap="shareToMoments">
        <text class="share-icon">ğŸŒŸ</text>
        <text class="share-text">åˆ†äº«åˆ°æœ‹å‹åœˆ</text>
      </view>
      <view class="share-option" bindtap="saveToAlbum">
        <text class="share-icon">ğŸ’¾</text>
        <text class="share-text">ä¿å­˜åˆ°ç›¸å†Œ</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œ -->
  <view class="bottom-actions">
    <view class="action-item" bindtap="viewWeeklyReport">
      <text class="action-icon">ğŸ“Š</text>
      <text class="action-text">å‘¨æŠ¥</text>
    </view>
    <view class="action-item" bindtap="exportReport">
      <text class="action-icon">ğŸ“¥</text>
      <text class="action-text">å¯¼å‡º</text>
    </view>
    <view class="action-item" bindtap="viewHistory">
      <text class="action-icon">ğŸ“š</text>
      <text class="action-text">å†å²æŠ¥å‘Š</text>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-overlay" wx:if="{{loading}}">
  <view class="loading-content">
    <view class="loading-spinner"></view>
    <view class="loading-text">æ­£åœ¨ç”ŸæˆæœˆæŠ¥...</view>
  </view>
</view>

<!-- æ—¥æœŸè¯¦æƒ…å¼¹çª— -->
<view class="day-detail-modal" wx:if="{{showDayDetail}}">
  <view class="modal-mask" bindtap="closeDayDetail"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">{{selectedDay.dateDisplay}}</view>
      <view class="modal-close" bindtap="closeDayDetail">Ã—</view>
    </view>
    <view class="day-activities">
      <view class="activity-item" wx:for="{{selectedDay.activities}}" wx:key="id">
        <view class="activity-icon">{{item.icon}}</view>
        <view class="activity-content">
          <view class="activity-title">{{item.title}}</view>
          <view class="activity-desc">{{item.description}}</view>
        </view>
        <view class="activity-points">+{{item.points}}</view>
      </view>
    </view>
  </view>
</view>

<!-- åˆ†äº«å¼¹çª— -->
<view class="share-modal" wx:if="{{showShareModal}}">
  <view class="modal-mask" bindtap="closeShareModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">åˆ†äº«æœˆæŠ¥</view>
      <view class="modal-close" bindtap="closeShareModal">Ã—</view>
    </view>
    <view class="share-options">
      <view class="share-option" bindtap="shareToFriend">
        <image class="share-icon" src="/images/icons/wechat.png"></image>
        <text class="share-text">åˆ†äº«ç»™æœ‹å‹</text>
      </view>
      <view class="share-option" bindtap="shareToMoments">
        <image class="share-icon" src="/images/icons/moments.png"></image>
        <text class="share-text">åˆ†äº«åˆ°æœ‹å‹åœˆ</text>
      </view>
      <view class="share-option" bindtap="saveToAlbum">
        <image class="share-icon" src="/images/icons/save.png"></image>
        <text class="share-text">ä¿å­˜åˆ°ç›¸å†Œ</text>
      </view>
    </view>
  </view>
</view>
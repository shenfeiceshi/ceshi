<!-- å°å…­æ—¥è®°è¯¦æƒ…é¡µé¢ - AIæ™ºèƒ½è¯„ä»· -->
<view class="page-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="header-content">
      <view class="back-btn" bindtap="goBack">
        <text class="back-icon">â€¹</text>
      </view>
      <view class="header-title">æ—¥è®°è¯¦æƒ…</view>
      <view class="header-actions">
        <view class="action-btn" bindtap="editDiary">
          <text class="action-icon">âœï¸</text>
        </view>
        <view class="action-btn" bindtap="shareDiary">
          <text class="action-icon">ğŸ“¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ—¥è®°å¡ç‰‡ -->
  <view class="diary-card">
    <!-- æ—¥æœŸå’Œå¿ƒæƒ…å¤©æ°” -->
    <view class="diary-header">
      <view class="date-section">
        <view class="date-main">{{diaryData.dateDisplay}}</view>
        <view class="date-sub">{{diaryData.weekDay}}</view>
      </view>
      <view class="mood-weather-section">
        <view class="mood-item" wx:if="{{diaryData.mood}}">
          <text class="mood-emoji">{{diaryData.moodEmoji}}</text>
          <text class="mood-name">{{diaryData.moodName}}</text>
        </view>
        <view class="weather-item" wx:if="{{diaryData.weather}}">
          <text class="weather-emoji">{{diaryData.weatherEmoji}}</text>
          <text class="weather-name">{{diaryData.weatherName}}</text>
        </view>
      </view>
    </view>

    <!-- æ—¥è®°å†…å®¹ -->
    <view class="diary-content">
      <view class="content-text">{{diaryData.content}}</view>
    </view>

    <!-- æ—¥è®°å›¾ç‰‡ -->
    <view class="diary-images" wx:if="{{diaryData.images && diaryData.images.length > 0}}">
      <view class="images-grid">
        <view class="image-item" 
              wx:for="{{diaryData.images}}" 
              wx:key="index"
              bindtap="previewImage" 
              data-index="{{index}}">
          <image class="diary-image" src="{{item.url || item}}" mode="aspectFill"></image>
          <view class="ai-badge" wx:if="{{item.isAiGenerated}}">
            <text class="ai-text">AI</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ—¥è®°æ ‡ç­¾ -->
    <view class="diary-tags" wx:if="{{diaryData.tags && diaryData.tags.length > 0}}">
      <view class="tag-item" wx:for="{{diaryData.tags}}" wx:key="*this">
        {{item}}
      </view>
    </view>

    <!-- æ—¥è®°ç»Ÿè®¡ -->
    <view class="diary-stats">
      <view class="stats-item">
        <text class="stats-icon">ğŸ“</text>
        <text class="stats-text">{{diaryData.wordCount}}å­—</text>
      </view>
      <view class="stats-item">
        <text class="stats-icon">ğŸ‘€</text>
        <text class="stats-text">{{diaryData.viewCount || 1}}æ¬¡æŸ¥çœ‹</text>
      </view>
      <view class="stats-item">
        <text class="stats-icon">â°</text>
        <text class="stats-text">{{diaryData.createTime}}</text>
      </view>
    </view>
  </view>

  <!-- AIè¯„ä»·å¡ç‰‡ -->
  <view class="ai-comment-card" wx:if="{{diaryData.aiComment}}">
    <view class="ai-header">
      <view class="ai-avatar">ğŸ¤–</view>
      <view class="ai-info">
        <view class="ai-name">AIå°åŠ©æ‰‹</view>
        <view class="ai-desc">ä¸ºä½ çš„æ—¥è®°å†™äº†æ¸©é¦¨è¯„è¯­</view>
      </view>
      <view class="ai-time">{{diaryData.aiComment.time}}</view>
    </view>
    
    <view class="ai-comment-content">
      <view class="comment-bubble">
        <view class="comment-text">{{diaryData.aiComment.text}}</view>
      </view>
    </view>

    <!-- AIè¯„ä»·æ“ä½œ -->
    <view class="ai-actions">
      <view class="ai-action-btn like {{aiLiked ? 'active' : ''}}" bindtap="toggleAiLike">
        <text class="action-emoji">{{aiLiked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
        <text class="action-text">{{aiLiked ? 'å·²èµ' : 'ç‚¹èµ'}}</text>
      </view>
      <view class="ai-action-btn regenerate" bindtap="regenerateAiComment">
        <text class="action-emoji">ğŸ”„</text>
        <text class="action-text">é‡æ–°ç”Ÿæˆ</text>
      </view>
    </view>
  </view>

  <!-- ç”ŸæˆAIè¯„ä»·æŒ‰é’® -->
  <view class="generate-ai-card" wx:if="{{!diaryData.aiComment && !generatingComment}}">
    <view class="generate-content" bindtap="generateAiComment">
      <view class="generate-icon">âœ¨</view>
      <view class="generate-text">
        <view class="generate-title">è®©AIä¸ºä½ çš„æ—¥è®°å†™è¯„è¯­</view>
        <view class="generate-desc">AIå°åŠ©æ‰‹ä¼šæ ¹æ®ä½ çš„æ—¥è®°å†…å®¹ï¼Œå†™ä¸€æ®µæ¸©é¦¨çš„è¯„è¯­å“¦ï¼</view>
      </view>
      <view class="generate-arrow">â€º</view>
    </view>
  </view>

  <!-- AIè¯„ä»·ç”Ÿæˆä¸­ -->
  <view class="generating-ai-card" wx:if="{{generatingComment}}">
    <view class="generating-content">
      <view class="generating-icon">
        <view class="loading-dot"></view>
        <view class="loading-dot"></view>
        <view class="loading-dot"></view>
      </view>
      <view class="generating-text">AIå°åŠ©æ‰‹æ­£åœ¨ä¸ºä½ å†™è¯„è¯­...</view>
    </view>
  </view>

  <!-- ç›¸å…³æ—¥è®°æ¨è -->
  <view class="related-section" wx:if="{{relatedDiaries.length > 0}}">
    <view class="section-title">
      <text class="title-icon">ğŸ“š</text>
      <text class="title-text">ç›¸å…³æ—¥è®°</text>
    </view>
    <scroll-view class="related-list" scroll-x="true">
      <view class="related-item" 
            wx:for="{{relatedDiaries}}" 
            wx:key="id"
            bindtap="viewRelatedDiary" 
            data-id="{{item.id}}">
        <view class="related-date">{{item.dateDisplay}}</view>
        <view class="related-preview">{{item.preview}}</view>
        <view class="related-mood">
          <text class="mood-emoji">{{item.moodEmoji}}</text>
          <text class="mood-name">{{item.moodName}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <view class="bottom-navigation">
    <view class="nav-item" bindtap="goToPrevDiary">
      <text class="nav-icon">â€¹</text>
      <text class="nav-text">ä¸Šä¸€ç¯‡</text>
    </view>
    <view class="nav-item main" bindtap="goToList">
      <text class="nav-icon">ğŸ“‹</text>
      <text class="nav-text">æ—¥è®°åˆ—è¡¨</text>
    </view>
    <view class="nav-item" bindtap="goToNextDiary">
      <text class="nav-icon">â€º</text>
      <text class="nav-text">ä¸‹ä¸€ç¯‡</text>
    </view>
  </view>
</view>

<!-- åˆ†äº«å¼¹çª— -->
<view class="share-modal" wx:if="{{showShareModal}}">
  <view class="modal-mask" bindtap="closeShareModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">åˆ†äº«æ—¥è®°</view>
      <view class="modal-close" bindtap="closeShareModal">Ã—</view>
    </view>
    <view class="share-options">
      <view class="share-option" bindtap="shareToFriend">
        <text class="share-emoji">ğŸ’¬</text>
        <text class="share-text">åˆ†äº«ç»™æœ‹å‹</text>
      </view>
      <view class="share-option" bindtap="generateShareImage">
        <text class="share-emoji">ğŸ–¼ï¸</text>
        <text class="share-text">ç”Ÿæˆå›¾ç‰‡</text>
      </view>
      <view class="share-option" bindtap="copyDiaryContent">
        <text class="share-emoji">ğŸ“‹</text>
        <text class="share-text">å¤åˆ¶å†…å®¹</text>
      </view>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-area-bottom"></view>
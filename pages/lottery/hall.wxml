<!--抽奖大厅页面-->
<view class="page-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">抽奖大厅</text>
    <text class="page-subtitle">用积分抽取精美奖品</text>
  </view>

  <!-- 用户积分 -->
  <view class="points-header">
    <text class="coin-icon">💰</text>
    <text class="points-text">我的积分</text>
    <text class="points-value">{{userPoints}}</text>
    <view class="points-detail-btn" bindtap="viewPointsDetail">
      <text class="detail-icon">📊</text>
      <text class="detail-text">明细</text>
    </view>
  </view>

  <!-- 抽奖转盘 -->
  <view class="lottery-wheel-container">
    <view class="wheel-background">
      <canvas canvas-id="lotteryWheel" class="lottery-wheel {{isSpinning ? 'spinning' : ''}}"></canvas>
      <view class="wheel-pointer"></view>
      <view class="wheel-center" bindtap="startLottery">
        <view class="center-text">{{isSpinning ? '抽奖中...' : '开始抽奖'}}</view>
        <view class="center-cost">消耗{{lotteryCost}}积分</view>
      </view>
    </view>
  </view>

  <!-- 奖品展示 -->
  <view class="prizes-section">
    <view class="section-title">
      <text class="section-icon">🎁</text>
      <text>奖品一览</text>
    </view>
    <view class="prizes-grid">
      <view class="prize-item" wx:for="{{prizes}}" wx:key="id">
        <text class="prize-image">{{item.emoji}}</text>
        <text class="prize-name">{{item.name}}</text>
        <text class="prize-points">{{item.points}}积分</text>
      </view>
    </view>
  </view>

  <!-- 最近中奖记录 -->
  <view class="recent-records" wx:if="{{recentRecords.length > 0}}">
    <view class="section-title">
      <text class="title-icon">🎉</text>
      <text>最近中奖</text>
    </view>
    <view class="records-list">
      <view class="record-item" wx:for="{{recentRecords}}" wx:key="id">
        <text class="record-avatar">{{item.prizeEmoji}}</text>
        <view class="record-info">
          <view class="record-prize">获得了 {{item.prizeName}}</view>
        </view>
        <view class="record-time">{{item.timeAgo}}</view>
      </view>
    </view>
  </view>

  <!-- 空状态提示 -->
  <view class="recent-records-empty" wx:if="{{recentRecords.length === 0}}">
    <view class="section-title">
      <text class="title-icon">🎉</text>
      <text>最近中奖</text>
    </view>
    <view class="empty-hint">
      <text class="empty-icon">🎯</text>
      <text class="empty-text">还没有中奖记录，快来试试手气吧！</text>
    </view>
  </view>

  <!-- 底部操作按钮 -->
  <view class="bottom-actions">
    <view class="action-btn" bindtap="viewRecords">
      <text class="btn-icon">📊</text>
      <text>我的记录</text>
    </view>
    <view class="action-btn" bindtap="manageLottery" wx:if="{{isAdmin}}">
      <text class="btn-icon">⚙️</text>
      <text>抽奖管理</text>
    </view>
  </view>
</view>

<!-- 中奖弹窗 -->
<view class="prize-modal {{showPrizeModal ? 'show' : ''}}" bindtap="closePrizeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="celebration-icon">🎉</text>
      <view class="modal-title">恭喜中奖！</view>
    </view>
    <view class="modal-body">
      <text class="prize-modal-image">{{wonPrize.emoji}}</text>
      <view class="prize-modal-name">{{wonPrize.name}}</view>
      <view class="prize-modal-desc">{{wonPrize.description}}</view>
    </view>
    <view class="modal-footer">
      <view class="modal-btn" bindtap="closePrizeModal">太棒了！</view>
    </view>
  </view>
</view>
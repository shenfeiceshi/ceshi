<!--ç§¯åˆ†æ˜ç»†é¡µé¢-->
<view class="page-container">

  <!-- ç§¯åˆ†ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="points-overview">
    <view class="overview-main">
      <text class="overview-icon">ğŸ’°</text>
      <view class="overview-content">
        <text class="total-points">{{pointsStats.totalPoints}}</text>
        <text class="total-label">å½“å‰æ€»ç§¯åˆ†</text>
      </view>
    </view>
    
    <view class="overview-stats">
      <view class="stat-item">
        <text class="stat-value">+{{pointsStats.monthlyEarned}}</text>
        <text class="stat-label">æœ¬æœˆè·å¾—</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">-{{pointsStats.monthlySpent}}</text>
        <text class="stat-label">æœ¬æœˆä½¿ç”¨</text>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å·¥å…·æ  -->
  <view class="filter-toolbar">
    <scroll-view class="filter-scroll" scroll-x="true">
      <view class="filter-tags">
        <!-- æ—¶é—´ç­›é€‰ -->
        <view class="filter-tag {{timeFilter === 'all' ? 'active' : ''}}" 
              bindtap="setTimeFilter" data-filter="all">
          å…¨éƒ¨
        </view>
        <view class="filter-tag {{timeFilter === 'today' ? 'active' : ''}}" 
              bindtap="setTimeFilter" data-filter="today">
          ä»Šå¤©
        </view>
        <view class="filter-tag {{timeFilter === 'week' ? 'active' : ''}}" 
              bindtap="setTimeFilter" data-filter="week">
          æœ¬å‘¨
        </view>
        <view class="filter-tag {{timeFilter === 'month' ? 'active' : ''}}" 
              bindtap="setTimeFilter" data-filter="month">
          æœ¬æœˆ
        </view>
        
        <!-- ç±»å‹ç­›é€‰ -->
        <view class="filter-divider"></view>
        <view class="filter-tag {{typeFilter === 'all' ? 'active' : ''}}" 
              bindtap="setTypeFilter" data-filter="all">
          å…¨éƒ¨ç±»å‹
        </view>
        <view class="filter-tag {{typeFilter === 'earn' ? 'active' : ''}}" 
              bindtap="setTypeFilter" data-filter="earn">
          è·å¾—
        </view>
        <view class="filter-tag {{typeFilter === 'spend' ? 'active' : ''}}" 
              bindtap="setTypeFilter" data-filter="spend">
          ä½¿ç”¨
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-container">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input class="search-input" 
             placeholder="æœç´¢ç§¯åˆ†è®°å½•" 
             value="{{searchKeyword}}"
             bindinput="onSearchInput" />
      <view class="search-clear {{searchKeyword ? 'show' : ''}}" 
            bindtap="clearSearch">
        <text class="clear-icon">Ã—</text>
      </view>
    </view>
  </view>

  <!-- ç§¯åˆ†è®°å½•åˆ—è¡¨ -->
  <view class="records-container">
    <view class="records-list" wx:if="{{filteredRecords.length > 0}}">
      <view class="record-item" 
            wx:for="{{filteredRecords}}" 
            wx:key="id"
            bindtap="viewRecordDetail" 
            data-record="{{item}}">
        
        <!-- è®°å½•ç±»å‹å›¾æ ‡ -->
        <view class="record-icon {{item.type === 'earn' ? 'earn' : 'spend'}}">
          <text class="icon-text">{{item.type === 'earn' ? '+' : '-'}}</text>
        </view>
        
        <!-- è®°å½•ä¿¡æ¯ -->
        <view class="record-info">
          <view class="record-source">{{item.source}}</view>
          <view class="record-time">{{item.date}} {{item.time}}</view>
          <view class="record-desc" wx:if="{{item.description}}">{{item.description}}</view>
        </view>
        
        <!-- ç§¯åˆ†æ•°é‡å’Œä½™é¢ -->
        <view class="record-amount">
          <text class="amount-value {{item.type === 'earn' ? 'earn' : 'spend'}}">
            {{item.type === 'earn' ? '+' : '-'}}{{item.amount}}
          </text>
          <text class="balance-value">ä½™é¢: {{item.balance}}</text>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredRecords.length === 0}}">
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-title">æš‚æ— ç§¯åˆ†è®°å½•</text>
      <text class="empty-desc">{{searchKeyword ? 'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³è®°å½•' : 'è¿˜æ²¡æœ‰ç§¯åˆ†è®°å½•å“¦~'}}</text>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && filteredRecords.length > 0}}">
    <text class="load-text">{{loading ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}</text>
  </view>
</view>

<!-- è®°å½•è¯¦æƒ…å¼¹çª— -->
<view class="detail-modal {{showDetailModal ? 'show' : ''}}" bindtap="closeDetailModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç§¯åˆ†è®°å½•è¯¦æƒ…</text>
      <view class="modal-close" bindtap="closeDetailModal">
        <text class="close-icon">Ã—</text>
      </view>
    </view>
    
    <view class="modal-body" wx:if="{{selectedRecord}}">
      <!-- è®°å½•ç±»å‹ -->
      <view class="detail-row">
        <text class="detail-label">ç±»å‹</text>
        <view class="detail-value">
          <text class="type-badge {{selectedRecord.type === 'earn' ? 'earn' : 'spend'}}">
            {{selectedRecord.type === 'earn' ? 'ç§¯åˆ†è·å¾—' : 'ç§¯åˆ†ä½¿ç”¨'}}
          </text>
        </view>
      </view>
      
      <!-- ç§¯åˆ†æ•°é‡ -->
      <view class="detail-row">
        <text class="detail-label">æ•°é‡</text>
        <text class="detail-value amount {{selectedRecord.type === 'earn' ? 'earn' : 'spend'}}">
          {{selectedRecord.type === 'earn' ? '+' : '-'}}{{selectedRecord.amount}}
        </text>
      </view>
      
      <!-- æ¥æº/ç”¨é€” -->
      <view class="detail-row">
        <text class="detail-label">{{selectedRecord.type === 'earn' ? 'æ¥æº' : 'ç”¨é€”'}}</text>
        <text class="detail-value">{{selectedRecord.source}}</text>
      </view>
      
      <!-- æ—¶é—´ -->
      <view class="detail-row">
        <text class="detail-label">æ—¶é—´</text>
        <text class="detail-value">{{selectedRecord.date}} {{selectedRecord.time}}</text>
      </view>
      
      <!-- ä½™é¢ -->
      <view class="detail-row">
        <text class="detail-label">æ“ä½œåä½™é¢</text>
        <text class="detail-value">{{selectedRecord.balance}}</text>
      </view>
      
      <!-- è¯¦ç»†æè¿° -->
      <view class="detail-row" wx:if="{{selectedRecord.description}}">
        <text class="detail-label">è¯¦æƒ…</text>
        <text class="detail-value desc">{{selectedRecord.description}}</text>
      </view>
      
      <!-- ç›¸å…³ä»»åŠ¡ -->
      <view class="detail-row" wx:if="{{selectedRecord.taskId}}">
        <text class="detail-label">ç›¸å…³ä»»åŠ¡</text>
        <text class="detail-value link" bindtap="viewRelatedTask" data-id="{{selectedRecord.taskId}}">
          æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ… â†’
        </text>
      </view>
    </view>
    
    <view class="modal-footer">
      <view class="modal-btn" bindtap="closeDetailModal">çŸ¥é“äº†</view>
    </view>
  </view>
</view>